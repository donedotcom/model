var DoneModel=function(){function b(b){return a[b]}var a={};return a.underscore={_:_},a.backbone=Backbone,a["./oo"]=function(){var a={exports:{}},c=a.exports,d=b("underscore")._,e=function(){},f=c.extend=function(a,b){var c=this,g;return a&&a.hasOwnProperty("constructor")?g=a.constructor:g=function(){return c.apply(this,arguments)},d.extend(g,c,b||{}),e.prototype=c.prototype,g.prototype=new e,d.extend(g.prototype,c.prototype,a||{}),g.prototype.constructor=g,g.__super__=c.prototype,g.extend=f,g},g=c.mixin=function(a){var b=this,c=b.prototype.initialize;return d.defaults(b,a),d.defaults(b.prototype,a.prototype),b};return a.exports}(),a["./path"]=function(){var a={exports:{}},c=a.exports,d=b("underscore")._;return c.leaf=function(a){return a.split(".").pop()},c.resource=function(a,b,c){var e=b.errors&&d.isUndefined(b.attributes),f=a.split("."),g=f.pop(),h=b;return d.each(f,function(a){h&&(e?h=h.errors[a]===undefined?undefined:h.errors[a][0]:(h.get(a)===undefined&&c&&(h.attributes[a]={}),h=h.get(a)))}),h},a.exports}(),a["./model_errors"]=function(){var a={exports:{}},c=a.exports,d=b("underscore")._,e=b("./path"),f=a.exports=function(a){this.errors=a||{}},g=":base";return f.prototype.add=function(a,b){this.errors[a]=this.errors[a]||[],this.errors[a].push(b)},f.prototype.add_to_base=function(a){this.add(g,a)},f.prototype.clear=function(){this.errors={}},f.prototype.on=function(a){var b=e.leaf(a),c=e.resource(a,this);if(!c)return undefined;var f=c.errors[b]||null;return f&&f.length===1?d.first(f):f},f.prototype.errorsToJSON=function(a){var b={},c=a?a+".":"";return d.each(this.errors,function(a,e){var g=[],h={};d.each(a,function(a){a instanceof f?b=d.extend(b,a.errorsToJSON(c+e)):g.push(a)}),g.length>0&&(h[c+e]=g,b=d.extend(b,h))}),b},f.prototype.on_base=function(){return this.on(g)},f.prototype.count=f.prototype.length=f.prototype.size=function(){var a=0;return d.each(this.errorsToJSON(),function(b){a+=d.isArray(b)?b.length:1}),a},f.prototype.isEmpty=function(){return d.isEmpty(this.errors)},a.exports}(),a["./model"]=function(){var a={exports:{}},c=a.exports,d=b("underscore")._,e=b("./oo"),f=b("./path"),g=b("./model_errors"),h=a.exports=function(a){return this.doneModelInitialize(a)},i={validates:function(a,b,c){var e;d.isFunction(a)&&(c=b,b=a,a=null),e={validate:b,field:a,message:c},this.Validators=this.Validators||[],this.Validators.push(e)},defineHook:function(a,b){this.hooks=this.hooks||{},this.hooks[a]=b},attributesToJSON:function(a){return a?typeof a!="object"?a:(a.attributes&&(a=a.attributes),d.each(a,function(b,c){typeof b=="object"?a[c]=h.attributesToJSON(b):a[c]=b}),a):null},extend:e.extend},j={doneModelInitialize:function(a){this._processHook("beforeCreate"),a&&a.attributes?(this.attributes=a.attributes,this.errors=new g(a.errors)):(this.attributes=a||{},this.errors=new g);if(typeof process!="undefined"&&process.title!=="browser"){var b=this;this.__defineGetter__("id",function(){return b.get("_id")})}else this.idElement="_id",this.id=this.attributes[this.idElement];return this._processHook("afterCreate"),this},get:function(a){var b=f.leaf(a,this),c=f.resource(a,this);return c?b==="id"?c.id||c.attributes.id:c._inSchema(b)&&c.attributes[b]===undefined?undefined:c._wrapSchemaType(b,c.attributes[b]):null},set:function(a,b){this._processHook("beforeSet");if(!a)return this;var c=this;return d.each(d.keys(a),function(b){var d=f.leaf(b,c),e=f.resource(b,c,!0);e&&(e.attributes[d]=h.attributesToJSON(a[b]))}),this._processHook("afterSet"),this},unset:function(a){var b=f.leaf(a,this),c=f.resource(a,this);return delete c.attributes[b],this},isValid:function(){return this._performDoneValidation(this.attributes)},_processHook:function(a){if(this.hooks){var b=this.hooks[a],c=this;b&&(b instanceof Array?d.each(b,function(a){a(c)}):this.hooks[a](this))}},_performDoneValidation:function(a){var b=this,c=this.constructor;return b.errors.clear(),d.each(d.keys(a),function(c){if(!b._inSchema(c)){b.errors.add(c,"Schema error");return}var e=b._wrapSchemaType(c,a[c]||a.attributes&&a.attributes[c]);e instanceof h&&(e.isValid()||b.errors.add(c,e.errors)),e instanceof Array&&d.detect(e,function(a){return a instanceof h?!a.isValid():!1})&&b.errors.add(c,"Embedded array validation errors")}),c.Validators&&d.each(c.Validators,function(c){var d=c.message,e;if(c.field){e=a[c.field];try{c.validate.call(b,e,d)}catch(f){b.errors.add(c.field,f.message)}}else try{c.validate.call(b,d)}catch(g){b.errors.add_to_base(g.message)}}),b.errors.isEmpty()},_inSchema:function(a){var b=this.constructor;return a==="_id"||!!b.Schema[a]},_enforceSchema:function(a){if(!this._inSchema(a))throw new Error("Schema error: "+a)},_wrapSchemaType:function(a,b){var c=this.constructor,e;return this._enforceSchema(a),d.isObject(c.Schema[a])?(e=c.Schema[a],e instanceof Array?(e=e[0],b?!b instanceof Array?[new e(b)]:d.map(b,function(a){return new e(a)}):[]):new e(b)):b}};return d.extend(h,i),d.extend(h.prototype,j),a.exports}(),a["./backbone_model"]=function(){var a={exports:{}},c=a.exports,d=b("underscore")._,e=b("backbone"),f=b("./model"),g=b("./oo"),h={},i={idAttribute:"_id",hooks:{afterSet:function(a){a.isValid()?a.trigger("change",a,a.errors,{}):a.trigger("error",a,a.errors,{})}},constructor:function(a,b){this.doneModelInitialize.apply(this,arguments),e.Model.call(this,this.attributes,b)},validate:function(a){return this._performDoneValidation(a),this.trigger("change:errors"),this.errors.count()!==0?this.errors:null},get:f.prototype.get,set:function(){var a=f.prototype.set.apply(this,arguments);return a.errors.isEmpty()}},j=a.exports=e.Model.extend(i,h);return j.mixin=g.mixin,j.mixin(f),a.exports}(),{Model:a["./model"],BackboneModel:a["./backbone_model"]}}()